@page "/teacher/my-students"
@using abp_obs_project.Permissions
@using abp_obs_project.Students
@using Volo.Abp.AspNetCore.Components.Web
@inherits abp_obs_projectComponentBase
@attribute [Authorize]

<Card>
    <CardHeader>
        <Row Class="justify-content-between">
            <Column ColumnSize="ColumnSize.IsAuto">
                <h2>
                    <i class="fas fa-user-graduate me-2"></i>@L["Menu:MyStudents"]
                </h2>
            </Column>
        </Row>
    </CardHeader>
    <CardBody>
        @if (IsTeacher)
        {
            @if (MyStudents != null && MyStudents.Any())
            {
                <DataGrid TItem="StudentDto"
                          Data="MyStudents"
                          Responsive="true"
                          ShowPager="false"
                          Striped="true"
                          Hoverable="true">
                    <DataGridColumns>
                        <DataGridColumn TItem="StudentDto"
                                        Field="@nameof(StudentDto.StudentNumber)"
                                        Caption="@L["StudentNumber"]">
                        </DataGridColumn>
                        <DataGridColumn TItem="StudentDto"
                                        Field="@nameof(StudentDto.FirstName)"
                                        Caption="@L["FirstName"]">
                        </DataGridColumn>
                        <DataGridColumn TItem="StudentDto"
                                        Field="@nameof(StudentDto.LastName)"
                                        Caption="@L["LastName"]">
                        </DataGridColumn>
                        <DataGridColumn TItem="StudentDto"
                                        Field="@nameof(StudentDto.Email)"
                                        Caption="@L["Email"]">
                        </DataGridColumn>
                        <DataGridColumn TItem="StudentDto"
                                        Field="@nameof(StudentDto.Gender)"
                                        Caption="@L["Gender"]">
                            <DisplayTemplate>
                                @L[$"Enum:Gender.{context.Gender}"]
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="StudentDto"
                                        Field="@nameof(StudentDto.Id)"
                                        Caption="@L["Actions"]"
                                        Sortable="false">
                            <DisplayTemplate>
                                <Button Color="Color.Primary" Size="Size.Small" Clicked="() => OpenStudentDetailsModal(context)">
                                    <i class="fas fa-eye me-1"></i>@L["View"]
                                </Button>
                            </DisplayTemplate>
                        </DataGridColumn>
                    </DataGridColumns>
                </DataGrid>
            }
            else
            {
                <Alert Color="Color.Info" Visible="true">
                    <AlertMessage>
                        <i class="fas fa-info-circle me-2"></i>@L["MyStudents:NoStudents"]
                    </AlertMessage>
                </Alert>
            }
        }
        else
        {
            <Alert Color="Color.Warning" Visible="true">
                <AlertMessage>
                    <i class="fas fa-exclamation-triangle me-2"></i>@L["Dashboard:NoAccessMessage"]
                </AlertMessage>
            </Alert>
        }
    </CardBody>
</Card>

<!-- Student Details Modal -->
<Modal @ref="StudentDetailsModal">
    <ModalContent Centered Size="ModalSize.Large">
        <ModalHeader>
            <ModalTitle>@SelectedStudent?.FirstName @SelectedStudent?.LastName</ModalTitle>
            <CloseButton Clicked="CloseStudentDetailsModal" />
        </ModalHeader>
        <ModalBody>
            @if (SelectedStudent != null)
            {
                <Row>
                    <Column ColumnSize="ColumnSize.Is6">
                        <Field>
                            <FieldLabel>@L["StudentNumber"]</FieldLabel>
                            <TextEdit Text="@SelectedStudent.StudentNumber" ReadOnly="true" />
                        </Field>
                    </Column>
                    <Column ColumnSize="ColumnSize.Is6">
                        <Field>
                            <FieldLabel>@L["Email"]</FieldLabel>
                            <TextEdit Text="@SelectedStudent.Email" ReadOnly="true" />
                        </Field>
                    </Column>
                </Row>
                <Row>
                    <Column ColumnSize="ColumnSize.Is6">
                        <Field>
                            <FieldLabel>@L["Gender"]</FieldLabel>
                            <TextEdit Text="@L[$"Enum:Gender.{SelectedStudent.Gender}"]" ReadOnly="true" />
                        </Field>
                    </Column>
                    <Column ColumnSize="ColumnSize.Is6">
                        <Field>
                            <FieldLabel>@L["BirthDate"]</FieldLabel>
                            <DateEdit TValue="DateTime" Date="@SelectedStudent.BirthDate" ReadOnly="true" />
                        </Field>
                    </Column>
                </Row>
                <Row>
                    <Column ColumnSize="ColumnSize.Is6">
                        <Field>
                            <FieldLabel>@L["Phone"]</FieldLabel>
                            <TextEdit Text="@SelectedStudent.Phone" ReadOnly="true" />
                        </Field>
                    </Column>
                    <Column ColumnSize="ColumnSize.Is6">
                        <Field>
                            <FieldLabel>Enrollment Date</FieldLabel>
                            <DateEdit TValue="DateTime" Date="@SelectedStudent.EnrollmentDate" ReadOnly="true" />
                        </Field>
                    </Column>
                </Row>
            }
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Secondary" Clicked="CloseStudentDetailsModal">@L["Close"]</Button>
        </ModalFooter>
    </ModalContent>
</Modal>
